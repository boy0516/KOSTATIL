## 프로시저

><span style ="color:black">__프로시저__는 SQL을 사용하여 __작성한 일련의 작업을 저장__해두고 __호출__을 통해 원할 때마다 __저장한 작업을 수행__하도록 하는 __절차형 SQL__이다.</span>

데이터베이스에 저장되어 수행되기 떄문에 스토어드(Stored) 프로시저라고 불리기도 한다.

- 사용용도
  - 시스템의 일일 마감작업
  - 일괄(Batch) 작업 등에 사용



- 프로시저의 구성
  - DECLARE
    - 프로시저의 명싱, 변수, 인수, 데이터 타입을 정의하는 선언부
  - BEGIN / END
    - 프로시저의 시작과 종료를 의미한다.
  - CONTROL
    - 조건문 또는 반복문이 삽입되어 순차적으로 처리된다.
  - SQL
    - __DML, DCL__이 삽입되어 데이터 관리를 위한 __조회, 추가, 수정, 삭제 작업__을 수행한다.
  - EXCEPTION
    - BEGIN ~ END 안의 구문 실행 시 예외가 발생하면 이를 처리하는 방법을 정의한다.
  - TRANSACTION
    - 수행된 데이터 작업들을 DB에 적용할지 취소할지를 결정하는 처리부이다



### 프로시저 생성

- 생성 명령어 : __CREATE PROCEDURE__
- 표기형식

```
CREATE [OR REPLACE] PROCEDURE 프로시저명(파라미터)
[지역변수 선언]
BEGIN
	프로시저 BODY;
END;
```

- OR REPLACE

  - 선택적인(Optional)예약어이다. 이 예약어를 사용하면 

    /__동일한 프로시저 이름이 이미 존재__/하는 경우, 

    /__기존에 있던 프로시저__를 __대체/__할 수 있다.

- 프로시저명

  - 생성하려는 프로시저의 이름

- 파라미터

  - IN : 
    - __호출 프로그램이 => 프로시저__ 에게 __값을 전달__할 떄 지정
  - OUT: 
    - __프로시저가 => 호출 프로그램__에게 __값을 반환__할 때 지정
  - INOUT: 
    - 호출 프로그램이 프로시저에게 값을 전달하고, 프로시저 실행 후 호출 프로그램에 값을 반환할 때 지정한다.
  - 매개변수형:
    - 호출 프로그램으로부터 전달받은 값을 저장할 변수의 이름을 지정
  - 자료형
    - 변수의 자료형을 지정
  
- 프로시저 BODY

  - 프로시저의 __코드를 기록하는 부분__이다.
  - __BEGIN에서 시작하여 END__로 끝나며, BEGIN과 END 사이에는 __적어도 하나의 SQL문__이 있어야 한다.



예제) '사원번호'를 입력받아 해당 사원의 '지급방식'을 "S"로 변경하는 프로시저를 생성하시오.

```
CREATE OR REPLACE PROCEDURE emp_change_s(i_사원번호 IN INT)
IS // 지역변수
BEGIN
	UPDATE 급여 SET 지급방식 = 'S' WHERE 사원번호 = i_사원번호;
	EXCEPTION
		WHEN PROGRAM_ERROR THEN
			ROLLBACK;
	COMMIT;
END;
```



### 프로시저 실행

- 표기형식

```
EXECUTE 프로시저명;
```

```
EXEC 프로시저명;
```

```
CALL 프로시저명;
```



예제) '사원번호' 32를 인수로 하여 위에 생성된 emp_change_s 프로시저를 실행하시오

```
EXECUTE emp_change_s(32);
```



### 프로시저 제거

- 표기형식

```
DROP PROCEDURE 프로시저명;
```



예제) 위에서 생성된 프로시져 emp_change_s를 제거하시오

```
DROP PROCEDURE emp_change_s
```

